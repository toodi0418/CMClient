<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>TMAG Web Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>
        TMAG Web Dashboard
        <span id="app-version" class="app-version">v—</span>
      </h1>
      <p>同步展示 Meshtastic 封包、CallMesh 狀態與 APRS 流程。</p>
    </header>

    <main>
      <section class="status-panel">
        <div class="status-item">
          <span class="label">Meshtastic：</span>
          <span id="status-label" class="value status-value">尚未連線</span>
        </div>
        <div class="status-item">
          <span class="label">CallMesh：</span>
          <span id="callmesh-label" class="value">尚未取得</span>
        </div>
        <div class="status-item">
          <span class="label">APRS：</span>
          <span id="aprs-status-label" class="value">尚未取得</span>
        </div>
      </section>

      <section class="counter-panel">
        <article class="counter-card">
          <span class="counter-label">10 分鐘封包</span>
          <span id="counter-packets" class="counter-value">0</span>
        </article>
        <article class="counter-card">
          <span class="counter-label">已上傳 APRS</span>
          <span id="counter-aprs" class="counter-value">0</span>
        </article>
        <article class="counter-card">
          <span class="counter-label">Mapping 節點</span>
          <span id="counter-mapping" class="counter-value">0</span>
        </article>
      </section>

      <nav class="main-nav">
        <button type="button" class="nav-btn active" data-target="summary-page">封包摘要</button>
        <button type="button" class="nav-btn" data-target="flow-page">Mapping 封包追蹤</button>
        <button type="button" class="nav-btn" data-target="telemetry-page">遙測數據</button>
        <button type="button" class="nav-btn" data-target="log-page">系統日誌</button>
      </nav>

      <section id="summary-page" class="page active">
        <section class="info-layout">
          <article class="info-card">
            <details class="info-details" open>
              <summary>CallMesh Provision</summary>
              <div class="info-content">
                <dl class="info-grid">
                  <div>
                    <dt>呼號</dt>
                    <dd id="callmesh-callsign">—</dd>
                  </div>
                  <div>
                    <dt>符號</dt>
                    <dd id="callmesh-symbol">—</dd>
                  </div>
                  <div>
                    <dt>座標</dt>
                    <dd id="callmesh-coords">—</dd>
                  </div>
                  <div>
                    <dt>PHG 詳細</dt>
                    <dd id="callmesh-phg">—</dd>
                  </div>
                  <div>
                    <dt>備註</dt>
                    <dd id="callmesh-comment" class="multiline">—</dd>
                  </div>
                  <div>
                    <dt>最後更新</dt>
                    <dd id="callmesh-updated">—</dd>
                  </div>
                </dl>
              </div>
            </details>
          </article>
        </section>

        <section class="table-panel">
          <header class="panel-header">
            <h2>封包摘要</h2>
            <span class="panel-meta">資料列最多保留 200 筆</span>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>時間</th>
                  <th>來源</th>
                  <th>最後轉發</th>
                  <th>類型</th>
                  <th>CH</th>
                  <th>Hops</th>
                  <th>SNR</th>
                  <th>RSSI</th>
                  <th>資訊</th>
                </tr>
              </thead>
              <tbody id="summary-table"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="flow-page" class="page">
        <section class="flow-panel">
          <header class="flow-header">
            <h2>Mapping 封包追蹤</h2>
            <p class="flow-hint">僅列出具 Mapping 資訊的位置封包；若已上傳 APRS 會顯示對應訊息。</p>
            <div class="flow-search-row">
              <input id="flow-search" type="search" placeholder="搜尋節點、呼號或註記" />
              <select id="flow-filter-state">
                <option value="all">全部封包</option>
                <option value="aprs">已上傳 APRS</option>
                <option value="pending">待上傳</option>
              </select>
            </div>
          </header>
          <div id="flow-empty-state" class="flow-empty">尚未收到符合條件的封包。</div>
          <div id="flow-list" class="flow-list"></div>
        </section>
      </section>

      <section id="telemetry-page" class="page">
        <article class="telemetry-panel">
          <header class="telemetry-header">
            <div class="telemetry-controls">
              <label for="telemetry-node-select">節點</label>
              <select id="telemetry-node-select" disabled>
                <option value="" selected>尚未收到遙測資料</option>
              </select>
            </div>
            <div class="telemetry-controls">
              <label for="telemetry-range-select">區間</label>
              <select id="telemetry-range-select">
                <option value="day">24 小時</option>
                <option value="week">7 天</option>
                <option value="month">30 天</option>
                <option value="year">1 年</option>
                <option value="custom">自訂</option>
              </select>
            </div>
            <div id="telemetry-range-custom" class="telemetry-range-custom hidden">
              <label class="telemetry-custom-field">
                <span>開始</span>
                <input type="datetime-local" id="telemetry-range-start" />
              </label>
              <span class="telemetry-range-separator">~</span>
              <label class="telemetry-custom-field">
                <span>結束</span>
                <input type="datetime-local" id="telemetry-range-end" />
              </label>
            </div>
            <div class="telemetry-chart-controls">
              <label for="telemetry-chart-mode">圖表</label>
              <select id="telemetry-chart-mode">
                <option value="all">全部</option>
                <option value="single">單一指標</option>
              </select>
              <select id="telemetry-chart-metric" class="hidden"></select>
            </div>
            <div class="telemetry-updated">
              <span class="label">更新</span>
              <span id="telemetry-updated-at">—</span>
            </div>
          </header>
          <div id="telemetry-empty-state" class="telemetry-empty">
            尚未收到遙測資料。
          </div>
          <section id="telemetry-charts" class="telemetry-charts hidden"></section>
          <div id="telemetry-table-wrapper" class="telemetry-table-wrapper hidden">
            <table class="telemetry-table">
              <thead>
                <tr>
                  <th>時間</th>
                  <th>節點</th>
                  <th>指標</th>
                  <th>額外資訊</th>
                </tr>
              </thead>
              <tbody id="telemetry-table-body"></tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="log-page" class="page">
        <section class="log-panel">
          <header class="panel-header">
            <h2>系統日誌</h2>
            <span class="panel-meta">CallMesh / APRS / 連線事件</span>
          </header>
          <ul id="log-list" class="log-list"></ul>
        </section>
      </section>
    </main>

    <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="main.js"></script>
  </body>
</html>
